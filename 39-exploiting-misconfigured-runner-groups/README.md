# Advanced Attack Scenario 9: Exploiting misconfigured runner groups and labels

This scenario demonstrates how an attacker can exploit a misconfigured runner group to gain access to a self-hosted runner and the sensitive data that it has access to.

## The Vulnerability

A workflow that uses a self-hosted runner with a specific label, but the runner group is misconfigured, allowing other repositories to use the same runner. The vulnerability lies in the fact that the runner group is not restricted to a specific repository, which allows an attacker to create a workflow in another repository that uses the same label to gain access to the runner.

**Vulnerable Code:**

```yaml
name: Vulnerable Workflow
on:
  push:
    branches: [ main ]
jobs:
  vulnerable_job:
    runs-on: [self-hosted, my-special-runner]
    steps:
      - name: Vulnerable Step
        run: |
          # This script has access to sensitive data
          cat /etc/sensitive-data
```

## The Exploitation

An attacker can create a workflow in another repository that uses the same label to gain access to the runner and the sensitive data that it has access to.

**Malicious Payload:**

```yaml
name: Malicious Workflow
on:
  push:
    branches: [ main ]
jobs:
  malicious_job:
    runs-on: [self-hosted, my-special-runner]
    steps:
      - name: Malicious Step
        run: |
          # This script will be executed on the same runner as the vulnerable workflow
          # and will have access to the same sensitive data.
          cat /etc/sensitive-data
```

**Expected Outcome:**

The attacker gains access to the sensitive data from the self-hosted runner.

## The Mitigation

To mitigate this vulnerability, you should properly configure your runner groups and labels. This includes:

*   **Restricting runner groups to specific repositories.** You can do this in the settings for your organization or repository.
*   **Using unique labels for each runner group.** This will help to prevent attackers from guessing the labels for your runner groups.
*   **Monitoring your runner groups for suspicious activity.** You can use the GitHub audit log to monitor for suspicious activity in your runner groups.
